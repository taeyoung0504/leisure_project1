<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script
	src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
<head>
<meta charset="utf-8">
<style>
body {
	font-family: Arial, sans-serif;
	background-color: #f5f5f5;
	color: #333;
}

h1 {
	text-align: center;
	margin: 20px 0;
}

h3 {
	font-size: 1.17em;
	margin-block-start: 1em;
	margin-block-end: 1em;
	margin-inline-start: 10px;
	margin-inline-end: 0px;
	font-weight: bold;
}

.container {
	margin: 10px auto;
	width: 90%;
	height: 100%;
	margin-left: 110px
}

table {
	width: 100%;
	border-collapse: collapse;
}

th, td {
	padding: 8px;
	text-align: left;
	border-bottom: 1px solid #ddd;
}

th {
	background-color: #f2f2f2;
	color: #333;
}

tr:nth-child(even) {
	background-color: #f9f9f9;
}

form {
	display: inline-block;
}

input[type="submit"] {
	background-color: #4CAF50;
	color: white;
	border: none;
	padding: 5px 10px;
	cursor: pointer;
}

input[type="submit"]:hover {
	background-color: #45a049;
}

button {
	border-radius: 5px;
	border-style: none;
}

.approve_btn {
	background-color: rgb(100, 177, 255);
}

.approve_btn:hover {
	background: #01939A;
}

.reject_btn {
	/* 	background-color: pink; */
	border-style: none;
}

.approveCancel_btn {
	background-color: rgb(192, 192, 192);
	/* border-style: none;  */
}

span.role-USER {
	color: black;
}

span.role-accomdationList {
	color: blue;
}

span.role-ADMIN {
	color: red;
}

.account-status-disabled {
	color: red;
}

.pagination {
	display: flex;
	justify-content: center;
	list-style: none;
	padding: 0;
	margin-top: 20px;
}

.page-item {
	margin: 0 5px;
}

.page-link {
	display: inline-block;
	padding: 5px 10px;
	border: 1px solid #ccc;
	border-radius: 3px;
	text-decoration: none;
	color: #333;
	background-color: #f2f2f2;
}

.page-link:hover {
	background-color: #e0e0e0;
}
</style>
<script>
	
</script>


</head>
<body>
<html layout:decorate="~{khk/adminNavbar}">
<div layout:fragment="adminNav" class="container my-3">
	<h1>등록 업체 리스트</h1>
	<div class="container">
		<div>
			<div class="input-group">
				<input type="text" id="search_kw" class="form-control"
					placeholder="업체명으로 찾기" th:value="${kw}">
				<button class="btn btn-outline-secondary" type="button"
					id="btn_search">검색</button>
			</div>

			<div id="searchResults">
				<table>
					<thead>
						<tr>
							<th>업체 등록 번호</th>
							<th>업체명</th>
							<th>등록자 ID</th>
							<th>수용 최대 인원</th>
							<th>업체 주소</th>
							<th>업종</th>
							<th>업체 삭제</th>
						</tr>
					</thead>
					<tbody id="accomdationList">
						<tr th:each="accomdationList : ${paging}"
							th:data-acc-id="${accomdationList.id}">
							<td th:text="${accomdationList.id}"></td>
							<td th:text="${accomdationList.acc_name}"></td>
							<td th:text="${accomdationList.username}"></td>
							<td th:text="${accomdationList.acc_max_people}"></td>
							<td th:text="${accomdationList.acc_address}"></td>
							<td th:text="${accomdationList.acc_sectors}"></td>
							<td>
								<!-- 								<button type="button" onclick="confirmDelete(this)">숙소삭제</button> -->
								<!-- 폼으로 숙소 삭제 버튼 감싸기 -->
								<form id="deleteForm" method="post" action="/admin/deleteAcc/"
									style="display: inline;">
									<input type="hidden" name="_csrf" value="${_csrf.token}" /> <input
										type="hidden" name="accId" th:value="${accomdationList.id}" />
									<button type="button" onclick="confirmDelete(this)">숙소삭제</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<!-- 페이징처리 시작 -->
		<div th:if="${!paging.isEmpty()}">
			<ul class="pagination justify-content-center">
				<!-- 이전 페이지 버튼 -->
				<li class="page-item" th:unless="${paging.first}"><a
					class="page-link" href="javascript:void(0)"
					th:data-page="${paging.number-1}"> <span>이전</span>
				</a></li>
				<!-- 페이지 번호 -->
				<li th:each="page: ${#numbers.sequence(0, paging.totalPages - 1)}"
					th:classappend="${page == paging.number} ? 'active' : ''"
					class="page-item"><a th:text="${page + 1}" class="page-link"
					th:href="@{|?page=${page}|}"></a></li>
				<!-- 다음 페이지 버튼 -->
				<li class="page-item" th:unless="${paging.last}"><a
					class="page-link" href="javascript:void(0)"
					th:data-page="${paging.number+1}"> <span>다음</span>
				</a></li>
			</ul>
			<!-- 페이징처리 끝 -->
			<form th:action="@{/admin/accomdationListPage}" method="get"
				id="searchForm">
				<input type="hidden" id="kw" name="kw" th:value="${kw}"> <input
					type="hidden" id="page" name="page" th:value="${paging.number}">
			</form>
		</div>

		<script type="text/javascript">
			const page_elements = document.getElementsByClassName("page-link");
			Array.from(page_elements).forEach(function(element) {
				element.addEventListener('click', function() {
					document.getElementById('page').value = this.dataset.page;
					document.getElementById('searchForm').submit();
				});
			});
			const btn_search = document.getElementById("btn_search");
			btn_search.addEventListener('click', function() {
				document.getElementById('kw').value = document
						.getElementById('search_kw').value;
				document.getElementById('page').value = 0; // 검색버튼을 클릭할 경우 0페이지부터 조회한다.
				document.getElementById('searchForm').submit();
			});

// 			// 해당 숙소를 삭제한다.
// 			function confirmDelete(buttonElement) {
// 				var accId = buttonElement.closest('tr').dataset.accId;
				
// 				if (!accId) {
// 					console.log("Error: data-acc-id attribute not found.");
// 					return;
// 				}

		
			
// 			 if (confirm("숙소를 삭제하시겠습니까?")) {
// 			        fetch(`/admin/deleteAcc/${accId}`, {
// 			            method: 'DELETE',
// 			            headers: {
// 			                'Content-Type': 'application/json',
// 			                'X-CSRF-TOKEN': '${_csrf.token}' // Thymeleaf 코드로 CSRF 토큰을 가져옵니다.
// 			            }
// 			        })
// 			        .then(response => {
// 			            if (response.ok) {
// 			                // 요청 성공
// 			                window.location.href = "/admin/accomdationListPage";
// 			            } else {
// 			                // 요청 실패
// 			                console.log("Error: " + response.status + " " + response.statusText);
// 			            }
// 			        })
// 			        .catch(error => {
// 			            console.log("Error: " + error);
// 			        });
// 			    }

// 			 }

<!-- 해당 숙소를 삭제한다. -->
function confirmDelete(buttonElement) {
    var accId = buttonElement.closest('tr').dataset.accId;

    if (!accId) {
        console.log("Error: data-acc-id attribute not found.");
        return;
    }

    Swal.fire({
        title: "숙소를 삭제하시겠습니까?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "예",
        cancelButtonText: "아니오",
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/admin/deleteAcc/${accId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': '${_csrf.token}' // Thymeleaf 코드로 CSRF 토큰을 가져옵니다.
                }
            })
            .then(response => {
                if (response.ok) {
                    // 요청 성공
                    window.location.href = "/admin/accomdationListPage";
                } else {
                    // 요청 실패
                    console.log("Error: " + response.status + " " + response.statusText);
                }
            })
            .catch(error => {
                console.log("Error: " + error);
            });
        }
    });
}
			
		</script>

		</body>
</html>